// CONFIGURATION
const MINING_ADDRESS = "NHbaiczJpmLsK4Nf2QiaXp87a6C4sP8uxDZi"; // Your real ID from the provider
// This adds a proxy prefix to bypass browser security
const PROXY = "https://corsproxy.io/?"; 
const API_URL = `${PROXY}https://api2.nicehash.com/main/api/v2/mining/external/${MINING_ADDRESS}/stats`;

async function fetchCloudMiningData() {
    try {
        const response = await fetch(API_URL);
        const data = await response.json();

        // üîç NiceHash V2 structure check:
        // Most external stats are nested inside 'stats' or 'miningStats'
        const stats = data.stats && data.stats[0] ? data.stats[0] : {};
        
        const unpaidAmount = stats.balance || 0; 
        const activeWorkers = data.totalDevices || 0; 
        const hashrate = stats.speedAccepted || 0;

        // Update UI
        document.getElementById('btc-balance').textContent = parseFloat(unpaidAmount).toFixed(8);
        document.getElementById('update-tag').textContent = `Cloud: ${activeWorkers} Rigs | ${hashrate} H/s`;
        
        // Sync with your USD converter
        if (typeof updateUSD === "function") updateUSD(unpaidAmount);

    } catch (error) {
        console.error("NiceHash Sync Error:", error);
        document.getElementById('update-tag').textContent = "Connection Error - Retrying...";
    }
}